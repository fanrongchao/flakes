#!/usr/bin/env bash
set -euo pipefail

hypr_conf="$HOME/flakes/dotfiles/hypr/hyprland.conf"

theme=$(sed -n 's/^\$theme[[:space:]]*=[[:space:]]*//p' "$hypr_conf" | head -n1)
if [ -z "$theme" ]; then
  exit 0
fi

base="$HOME/flakes/dotfiles"

copy_theme() {
  local src="$1"
  local dest="$2"
  if [ -f "$src" ]; then
    mkdir -p "$(dirname "$dest")"
    cp -f "$src" "$dest"
  fi
}

copy_theme "$base/tmux/themes/$theme.conf" "$base/tmux/theme.conf"
copy_theme "$base/kitty/themes/$theme.conf" "$HOME/.config/kitty/theme.conf"
copy_theme "$base/hyprlock/themes/$theme.conf" "$base/hyprlock/hyprlock.conf"

if command -v tmux >/dev/null 2>&1; then
  tmux source-file "$HOME/.config/tmux/tmux.conf" 2>/dev/null || true
fi
